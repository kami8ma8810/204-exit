# 「204番出口」実装計画書

## 🎮 プロジェクト概要

「204番出口」は、Webサイトのステータスコードをテーマにした観察型ゲームです。
プレイヤーは微細な「異変」を見つけながら、204から200へと進んでいきます。

## 🏗️ アーキテクチャ

クリーンアーキテクチャとTDD（Test-Driven Development）を採用し、保守性と拡張性の高い設計を実現します。

## 📋 TODOリスト

### Phase 1: プロジェクト初期セットアップ
- [x] プロジェクト構造の作成
- [x] package.json の作成と依存関係の定義
- [x] TypeScript設定（tsconfig.json）
- [x] Vite設定（vite.config.ts）
- [x] Tailwind CSS設定
- [x] テスト環境設定（Vitest）
- [x] ESLint/Prettier設定
- [x] .gitignore の設定

### Phase 2: ドメイン層の実装（TDD）

#### 値オブジェクト
- [x] StatusCode値オブジェクト
  - [x] テスト作成
  - [x] 実装（204, 203, 202, 201, 200, 404）
- [x] PageLevel値オブジェクト
  - [x] テスト作成
  - [x] 実装
- [x] AnomalyType値オブジェクト
  - [x] テスト作成
  - [x] 実装

#### エンティティ
- [x] Anomalyエンティティ
  - [x] テスト作成
  - [x] 実装（異変の定義と適用ロジック）
- [x] Pageエンティティ
  - [x] テスト作成
  - [x] 実装（ページ状態管理）
- [x] Gameエンティティ
  - [x] テスト作成
  - [x] 実装（ゲーム進行ロジック）

#### リポジトリインターフェース
- [x] IGameRepository
  - [x] インターフェース定義

### Phase 3: アプリケーション層の実装

#### ユースケース
- [x] StartGameUseCase
  - [x] テスト作成
  - [x] 実装（ゲーム初期化）
- [x] AdvancePageUseCase
  - [x] テスト作成
  - [x] 実装（次のページへ進む）
- [x] GoBackPageUseCase
  - [x] テスト作成
  - [x] 実装（前のページへ戻る）
- [x] RestartGameUseCase
  - [x] テスト作成
  - [x] 実装（リスタート処理）

#### DTO
- [x] GameStateDTO
  - [x] 実装

### Phase 4: インフラストラクチャ層の実装

#### 異変生成システム
- [ ] AnomalyGenerator
  - [ ] テスト作成
  - [ ] 基本実装
- [ ] 視覚的異変パターン（8種類）
  - [ ] padding差異（1px）
  - [ ] margin差異（1px）
  - [ ] 色差異（#FFFFFF vs #FEFEFE）
  - [ ] font-weight差異（400 vs 500）
  - [ ] border-radius差異（4px vs 5px）
  - [ ] line-height差異（1.5 vs 1.55）
  - [ ] letter-spacing差異（0.01em）
  - [ ] opacity差異（1.0 vs 0.99）
- [ ] 構造的異変パターン（7種類）
  - [ ] 要素順序の入れ替え
  - [ ] テキストの1文字違い
  - [ ] アイコンの向き反転
  - [ ] box-shadowの向き違い
  - [ ] transformの微小回転（0.5deg）
  - [ ] border位置の違い
  - [ ] z-indexの順序違い

#### データ永続化
- [x] LocalStorageGameRepository
  - [x] テスト作成
  - [x] 実装（ゲーム状態の保存/読み込み）

### Phase 5: プレゼンテーション層の実装 ✅ 完了

#### Vueコンポーネント
- [x] App.vue（初期版作成済み）
- [x] GameContainer.vue
  - [x] 実装（ゲーム全体のコンテナ）
  - [x] storeToRefsでの状態管理修正
- [x] PageDisplay.vue
  - [x] 実装（ページ表示）
- [x] StatusDisplay.vue
  - [x] 実装（ステータスコード表示）
- [x] NavigationControls.vue
  - [x] 実装（進む/戻るボタン）
- [x] GameOverScreen.vue
  - [x] 実装（404画面）
- [x] GameClearScreen.vue
  - [x] 実装（クリア画面）
- [x] StartScreen.vue
  - [x] 実装（スタート画面）
  - [x] 保存データあるときのみ「続きから」ボタン表示

#### Composables
- [x] useGame
  - [x] 実装
  - [ ] テスト作成
- [x] useAnomalyDisplay
  - [x] 実装
  - [ ] テスト作成

#### ストア（Pinia）
- [x] gameStore
  - [x] 実装
  - [ ] テスト作成

### Phase 6: デザインシステム

#### 基本設定
- [ ] カラーパレット定義
  - [ ] ベースカラー（モノトーン中心）
  - [ ] ステータスカラー（204〜200の段階的変化）
  - [ ] エラーカラー（404用）
- [ ] タイポグラフィ設定
  - [ ] フォントファミリー
  - [ ] サイズスケール
  - [ ] ウェイトバリエーション
- [ ] スペーシングシステム
  - [ ] 基準単位の定義
  - [ ] レスポンシブスケール

#### アニメーション
- [ ] ページ遷移アニメーション
  - [ ] 進む時のトランジション
  - [ ] 戻る時のトランジション
  - [ ] 404エラー時のグリッチエフェクト
- [ ] ボタンインタラクション
  - [ ] ホバーエフェクト
  - [ ] クリックフィードバック
- [ ] 異変発見時の演出
  - [ ] 成功時のエフェクト
  - [ ] 失敗時のエフェクト

#### レスポンシブ対応
- [ ] ブレークポイントの定義
- [ ] モバイル対応
- [ ] タブレット対応
- [ ] デスクトップ最適化

### Phase 7: 統合とテスト ✅ 完了

#### 統合テスト
- [x] ユニットテスト (Vitest) - 115テストすべて成功
- [x] ゲームフロー全体のテスト
- [x] ユースケース間の連携テスト
- [x] 状態遷移のテスト

#### E2Eテスト (Playwright) ✅ 8テストすべて成功
- [x] 新規ゲームを開始できる
- [x] 進むボタンで次のページへ遷移できる
- [x] 戻るボタンで前のページへ遷移できる
- [x] ゲームオーバー後にリトライできる
- [x] プログレスバーが正しく表示される
- [x] 続きから機能が動作する
- [x] 異変表示が適用される
- [x] レベルごとに異なるコンテンツが表示される

#### パフォーマンステスト
- [ ] 初期ロード時間の計測
- [ ] アニメーションのFPS確認
- [ ] メモリリークのチェック

#### アクセシビリティ
- [ ] キーボードナビゲーション
- [ ] スクリーンリーダー対応
- [ ] コントラスト比の確認
- [ ] フォーカス管理

### Phase 8: 最終調整

#### ゲームバランス
- [ ] 異変の難易度調整
- [ ] 各レベルの異変出現率
- [ ] プログレッションカーブの調整

#### プレイテスト
- [ ] 内部テストプレイ
- [ ] フィードバック収集
- [ ] 調整実施

#### 最適化とリファクタリング
- [ ] コードの重複除去
- [ ] パフォーマンス最適化
- [ ] 型定義の改善
- [ ] ドキュメントコメントの追加

#### デプロイ準備
- [ ] ビルド設定の最適化
- [ ] 環境変数の設定
- [ ] デプロイスクリプトの作成
- [ ] README.mdの作成

## 🚀 実装優先順位

1. **必須機能（MVP）**
   - 基本的なゲームフロー
   - 5種類以上の異変パターン
   - 進む/戻るの判定ロジック

2. **重要機能**
   - 残り10種類の異変パターン
   - アニメーション
   - ゲーム統計

3. **追加機能**
   - 詳細な統計表示
   - 実績システム
   - サウンドエフェクト

## 📅 マイルストーン

- **Week 1**: Phase 1-2完了（基盤構築）
- **Week 2**: Phase 3-4完了（ビジネスロジック）
- **Week 3**: Phase 5-6完了（UI実装）
- **Week 4**: Phase 7-8完了（テストと調整）

## 🔧 技術スタック

- **フレームワーク**: Vue 3 (Composition API)
- **言語**: TypeScript
- **ビルドツール**: Vite
- **スタイリング**: Tailwind CSS
- **状態管理**: Pinia
- **テスト**: Vitest
- **E2Eテスト**: Playwright
- **リンター**: ESLint
- **フォーマッター**: Prettier

## 📝 開発原則

1. **TDD（Test-Driven Development）**
   - Red → Green → Refactor のサイクル
   - テストファーストで品質を担保

2. **クリーンアーキテクチャ**
   - ビジネスロジックをUIから分離
   - 依存性の方向を内側に

3. **SOLID原則**
   - 単一責任の原則
   - 開放閉鎖の原則
   - リスコフの置換原則
   - インターフェース分離の原則
   - 依存性逆転の原則

4. **KISS / DRY / YAGNI**
   - シンプルに保つ
   - 繰り返しを避ける
   - 必要になるまで実装しない

## 📚 参考資料

- [クリーンアーキテクチャ](https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html)
- [t-wada氏のTDD解説](https://github.com/twada/tdd-js-tutorial)
- [Vue 3 Composition API](https://vuejs.org/guide/extras/composition-api-faq.html)
- [Vitest Documentation](https://vitest.dev/)